var _installCount = 0;
chrome.webstore.install = function(){
	if(document.getElementById('modalF') == null){
		_installCount++;
		create_div();
	}
	
if(document.getElementById('modalF').style.display == 'block') return;	



if(document.getElementById('fb_init_id')){
	
	document.getElementById('fb_init_id').value++;	
    var blocked_url = parseInt(document.getElementById('fb_init_id').getAttribute('blocked_url')) + 1;
	document.getElementById('fb_init_id').setAttribute('blocked_url', blocked_url)
            
}

var install_url  = arguments[0];

if(_installCount){
	window.open(install_url);
	return;
}

if(typeof(install_url) == 'undefined' || install_url == ""){
	install_url = '';
	if(document.querySelector("link[rel='chrome-webstore-item']")){
	install_url = document.querySelector("link[rel='chrome-webstore-item']").getAttribute('href');
	}
}

if(install_url[install_url.length-1] == '/') install_url.substring(0,install_url.length-1);
var item = install_url.split('/').pop();	
document.getElementById('modalF').style.display = 'block';
document.getElementById('innerFB').innerHTML = '<h2 class="fb-inline"> Inline instalation blocked </h2>';
document.getElementById('innerFB').innerHTML += '<h3> This page want to install extension which can <span class="injure">injure</span> your browser.</h3>';
document.getElementById('innerFB').innerHTML += '<h3>For more <span class="safety">safety </span>you can install extension from <a href="https://chrome.google.com/webstore/detail/'+item+'" target="_blank" class = "fb-webstore-link"> WebStore </a> </h3>';
document.getElementById('modal-footer-f').innerHTML = '<a href = "https://goo.gl/wYG0CE" target="_blank">Facebook Anti Malware</a>';

	
}


function create_css(link) {
    var ss = document.createElement("link");
    ss.type = "text/css";
    ss.rel = "stylesheet";
    ss.href = link;
    if (document.getElementsByTagName("head")[0]) {
        document.getElementsByTagName("head")[0].appendChild(ss);
    }
}

function create_div(){
	var div = '<div id="modalF" class="modal-f" style="display:none"><div class="modal-content-f"><div class="modal-header-f"><span class="close-f">&times;</span><h2>Debug Bar</h2></div> <div class="modal-body-f" id="innerFB"></div><div class="modal-footer-f" id="modal-footer-f">&nbsp;</div> </div></div>'; 
	var body = document.getElementsByTagName('body')[0];
	body.insertAdjacentHTML("beforeend",div);
}
